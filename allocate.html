<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Topic Allocation | ME3273</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.card{
  background:#fff;
  width:100%;
  max-width:520px;
  margin:24px 12px;
  padding:24px;
  border-radius:16px;
  box-shadow:0 15px 40px rgba(0,0,0,.25);
}
h1{
  font-size:16px;
  text-align:center;
  color:#203a43;
  margin:0;
}
h2{
  font-size:14px;
  text-align:center;
  color:#555;
  margin:6px 0 14px;
}
.infoBox{
  background:#f5f7fa;
  border-radius:12px;
  padding:14px;
  margin-top:16px;
  font-size:14px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:30px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  margin-top:18px;
}
.btn-logout{
  background:#c0392b;
  color:#fff;
}
button:disabled{
  background:#999;
  cursor:not-allowed;
}
.footer{
  margin:12px 0 20px;
  text-align:center;
  font-size:13px;
  color:#e0e0e0;
}
</style>
</head>

<body>

<div class="card">

  <!-- DEFAULT WELCOME (IMMEDIATE) -->
  <h1 id="welcome">Welcome Student</h1>
  <h2>Group Discussion & Seminar (ME3273)</h2>

  <!-- LOADING MESSAGE -->
  <div id="loadingBox" class="infoBox">
    <b>Getting details, please wait…</b>
  </div>

  <!-- FINAL CONTENT -->
  <div id="resultBox" class="infoBox" style="display:none"></div>
  <div id="seminarBox" class="infoBox" style="display:none"></div>

  <button id="logoutBtn" class="btn-logout" disabled onclick="logout()">Logout</button>

</div>

<div class="footer">
  <div>Developed by Rajesh Akula</div>
  <div>© 2026 · IIEST Shibpur</div>
</div>

<script>
const BACKEND =
"https://script.google.com/macros/s/AKfycbxAOPaDRPGJKA4reATcVo9m17USl7llQ7XD-0WnOC0Fvh04rzPuGAps6_L5BN-qp-Yg2Q/exec";

const token = new URLSearchParams(location.search).get("token");

/* ---------- LOAD ALL DATA TOGETHER ---------- */
loadAll();

function loadAll(){

  const dashboardReq = fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"dashboard",
      token
    })
  }).then(r=>r.json());

  const seminarReq = fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"getSeminarTopic",
      token
    })
  }).then(r=>r.json());

  Promise.all([dashboardReq, seminarReq])
    .then(([dash, sem]) => {

      loadingBox.style.display = "none";

      /* ---- DASHBOARD ---- */
      if(dash.status !== "ASSIGNED"){
        resultBox.innerHTML =
          "<b>No group discussion topic assigned.</b>";
        resultBox.style.display = "block";
        logoutBtn.disabled = false;
        return;
      }

      welcome.innerText =
        `Welcome ${dash.name} (${dash.roll})`;

      let html =
        `<b>Assigned Group Discussion Topic:</b><br>
         ${dash.project} – ${dash.projectName}<br><br>
         <b>Group Members:</b><br>`;

      dash.team.forEach((s,i)=>{
        html += `${i+1}. ${s.name} (${s.roll})<br>`;
      });

      resultBox.innerHTML = html;
      resultBox.style.display = "block";

      /* ---- SEMINAR TOPIC ---- */
      if(sem.topic){
        seminarBox.innerHTML =
          `<b>Submitted Seminar Topic:</b><br>
           <span style="color:#1b5e20">
           "${sem.topic}"
           </span>`;
        seminarBox.style.display = "block";
      }

      logoutBtn.disabled = false;
    })
    .catch(()=>{
      loadingBox.innerHTML =
        "<b style='color:#b71c1c'>Unable to load details. Please try again.</b>";
    });
}

/* ---------- LOGOUT ---------- */
function logout(){
  logoutBtn.disabled = true;

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"logout",
      token
    })
  })
  .finally(()=>{
    location.href="login.html";
  });
}
</script>

</body>
</html>
